import t from"@braid/vue-formulate";import{equals as e}from"@braid/vue-formulate/src/libs/utils.js";import o from"imask";import n from"@braid/vue-formulate/src/Formulate";var r=function(t){return void 0===t&&(t=[]),this.defaultHook=function(t){return t},this.setHooks(t)};r.prototype.parse=function(t){void 0===t&&(t=[]);var e=Array.isArray(t)?t:[];for(var o of e)this.isProperHook(o)&&this.hooks.push(o);return this},r.prototype.addHook=function(t){return this.isProperHook(t)&&this.isNewHook(t)&&this.hooks.push(t),this},r.prototype.setHooks=function(t){return void 0===t&&(t=[]),this.hooks=t.filter(this.isProperHook),this},r.prototype.setDefault=function(t){return this.defaultHook=t,this},r.prototype.isProperHook=function(t){return t&&"object"==typeof t&&"function"==typeof t.handler},r.prototype.isNewHook=function(t){return this.hooks.findIndex((function(e){return e===t}))<0},r.prototype.getHooks=function(){return this.hooks},r.prototype.empty=function(){return 0===this.hooks.length},r.prototype.apply=function(t,e){return this.empty()?this.defaultHook(t,e):this.hooks.reduce((function(t,o){return o.handler(t,e)}),t)},r.prototype.asSingleHook=function(){var t=this;return{handler:function(e,o){return t.apply(e,o)}}};var s={type:Object,default:function(){return{model:[],schema:[],schemaOptions:[],schemaNode:[],schemaComponent:[]}}};var a=t.defaults.components.FormulateInput,i=a.props,c=(a.created,a.watch),l=a.computed,p=function(t,e){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&-1===e.indexOf(n)&&(o[n]=t[n]);return o}(a,["props","created","watch","computed"]);function u(t,e,o,n,r,s,a,i,c,l){"boolean"!=typeof a&&(c=i,i=a,a=!1);var p,u="function"==typeof o?o.options:o;if(t&&t.render&&(u.render=t.render,u.staticRenderFns=t.staticRenderFns,u._compiled=!0,r&&(u.functional=!0)),n&&(u._scopeId=n),s?(p=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),e&&e.call(this,c(t)),t&&t._registeredComponents&&t._registeredComponents.add(s)},u._ssrRegister=p):e&&(p=a?function(t){e.call(this,l(t,this.$root.$options.shadowRoot))}:function(t){e.call(this,i(t))}),p)if(u.functional){var h=u.render;u.render=function(t,e){return p.call(e),h(t,e)}}else{var m=u.beforeCreate;u.beforeCreate=m?[].concat(m,p):[p]}return o}var h=Object.assign({},p,{props:Object.assign({},i,{modelHook:{type:[Function,Object,Array],default:null},standalone:{type:Boolean,default:function(){return!1}}}),created:function(){this.applyInitialValue(),!this.standalone&&this.formulateRegister&&"function"==typeof this.formulateRegister&&this.formulateRegister(this.nameOrFallback,this),this.applyDefaultValue(),this.disableErrors||"function"!=typeof this.observeErrors||this.observeErrors({callback:this.setErrors,type:"input",field:this.nameOrFallback}),this.updateLocalAttributes(this.$attrs),this.performValidation()},computed:Object.assign({},l,{slotProps:function(){var t=this.$formulate.slotProps.bind(this.$formulate);return{label:t(this.type,"label",this.typeProps),help:t(this.type,"help",this.typeProps),errors:t(this.type,"errors",this.typeProps),repeatable:t(this.type,"repeatable",this.typeProps),addMore:t(this.type,"addMore",this.typeProps),remove:t(this.type,"remove",this.typeProps),component:t(this.type,"component",this.typeProps)}}}),watch:Object.assign({},c,{"context.model":{handler:function(t,e){var o=new r;Array.isArray(this.modelHook)?this.modelHook.map((function(t){return o.addHook(t)})):"function"==typeof this.modelHook?o.addHook({handler:this.modelHook}):o.addHook(this.modelHook),(this.$formulate.options.hooks&&this.$formulate.options.hooks.model?this.$formulate.options.hooks.model:[]).map((function(t){return o.addHook(t)}));var n=t;"box"===this.context.classification&&"string"==typeof t&&0===t.length&&(n=!1),t!==e&&o.hooks.length>0&&(this.context.model=o.apply(n,{oldModel:e,context:this.context}))}}})}),m=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{class:t.context.classes.outer,attrs:{"data-classification":t.classification,"data-has-errors":t.hasErrors,"data-is-showing-errors":t.hasVisibleErrors,"data-has-value":t.hasValue,"data-type":t.type},on:{click:function(e){return t.$emit("outer-click")}}},[o("div",{class:t.context.classes.wrapper,on:{click:function(e){return t.$emit("wrapper-click")}}},["before"===t.context.labelPosition?t._t("label",[t.context.hasLabel?o(t.context.slotComponents.label,t._b({tag:"component",attrs:{context:t.context}},"component",t.context.slotProps.label,!1)):t._e()],null,t.context):t._e(),t._v(" "),"before"===t.context.helpPosition?t._t("help",[t.context.help?o(t.context.slotComponents.help,t._b({tag:"component",attrs:{context:t.context}},"component",t.context.slotProps.help,!1)):t._e()],null,t.context):t._e(),t._v(" "),t._t("element",[o(t.context.component,t._g(t._b({tag:"component",attrs:{context:t.context}},"component",t.context.slotProps.component,!1),t.listeners),[t._t("default",null,null,t.context)],2)],null,t.context),t._v(" "),"after"===t.context.labelPosition?t._t("label",[t.context.hasLabel?o(t.context.slotComponents.label,t._b({tag:"component",attrs:{context:t.context}},"component",t.context.slotProps.label,!1)):t._e()],null,t.context):t._e()],2),t._v(" "),"after"===t.context.helpPosition?t._t("help",[t.context.help?o(t.context.slotComponents.help,t._b({tag:"component",attrs:{context:t.context}},"component",t.context.slotProps.help,!1)):t._e()],null,t.context):t._e(),t._v(" "),t._t("errors",[t.context.disableErrors?t._e():o(t.context.slotComponents.errors,t._b({tag:"component",attrs:{type:"FormulateErrors"===t.context.slotComponents.errors&&"input",context:t.context}},"component",t.context.slotProps.errors,!1))],null,t.context)],2)};m._withStripped=!0;var f=u({render:m,staticRenderFns:[]},void 0,h,void 0,!1,void 0,!1,void 0,void 0,void 0);function d(t,e,o){void 0===o&&(o={});var n=o.hooks,s=o.h,a=o.state;if(t&&"object"==typeof t&&!Array.isArray(t)){var i=t.children;void 0===i&&(i=null);var c=t.component;void 0===c&&(c=f);var l=t.depth;void 0===l&&(l=1);var p=t.modelHook,u=function(t,e){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&-1===e.indexOf(n)&&(o[n]=t[n]);return o}(t,["children","component","depth","modelHook"]),h=c===f?u.type||"text":"",m=u.name||h||"el",d=u.id||m+"-"+l+"-"+e,y=Array.isArray(i)?i.map((function(t){return Object.assign(t,{depth:l+1})})):i,k=(new r).setHooks(n.model).addHook(p).asSingleHook(),b=Object.assign({name:m,type:h,key:d,depth:l,component:c,definition:{attrs:Object.assign({},u,{modelHook:k})},children:v(y,{hooks:n,h:s,state:a})});return(new r).setHooks(n.schemaNode).setDefault((function(){return b})).apply(b,{state:a})}return null}function v(t,e){void 0===e&&(e={});var o=e.hooks,n=e.h,s=e.state;return Array.isArray(t)?t.map((function(t,e){var a=d(t,e,{hooks:o,h:n,state:s});return(new r).setHooks(o.schemaComponent).setDefault((function(){return n(a.component,a.definition,a.children)})).apply(a)})):t}var y={functional:!1,name:"FormulateSchema",props:{schema:t.defaults.components.FormulateForm.props.schema,hooks:s,formClass:{type:String,default:null}},data:function(){return{schemaHooks:null,schemaOptionsHooks:null}},methods:{emit:function(t,e){this.$emit(t,e)}},beforeMount:function(){this.schemaHooks=(new r).setHooks(this.hooks.schema),this.schemaOptionsHooks=(new r).setHooks(this.hooks.schemaOptions).setDefault((function(t){return t}))},render:function(t){return this.schemaHooks.apply(t("div",{class:this.$props.formClass},v(this.schema,this.schemaOptionsHooks.apply({hooks:this.hooks,h:t,state:{}},{emit:this.emit,props:this.$props}))),{emit:this.emit,props:this.$props})}},k={extends:t.defaults.components.FormulateForm,components:{FormulateSchema:y},props:{hooks:s,formClass:{type:String,default:null}},computed:{cleanedHooks:function(){var e=this,o=s.default();return Object.keys(o).forEach((function(t){o[t]=(new r).parse(e.hooks[t]).getHooks()})),t.merge(this.$formulate.options.hooks||{},o)}},watch:{formulateValue:{handler:function(t){var o=this;this.isVmodeled&&t&&"object"==typeof t&&Array.from(new Set(Object.keys(t).concat(Object.keys(this.proxy)))).forEach((function(n){e(t[n],o.proxy[n])||(o.setFieldValue(n,t[n]),o.registry.has(n)&&!e(t[n],o.registry.get(n).proxy)&&(o.registry.get(n).context.model=t[n]))}))},deep:!0}}},b=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("form",{class:t.classes,on:{submit:function(e){return e.preventDefault(),t.formSubmitted(e)}}},[t.schema?o("FormulateSchema",{attrs:{schema:t.schema,hooks:t.cleanedHooks,formClass:t.formClass},on:{events:function(e){return t.$emit("events",e)}}}):t._e(),t._v(" "),t.hasFormErrorObservers?t._e():o("FormulateErrors",{attrs:{context:t.formContext}}),t._v(" "),t._t("default")],2)};b._withStripped=!0;var x=u({render:b,staticRenderFns:[]},void 0,k,void 0,!1,void 0,!1,void 0,void 0,void 0),_=function(){this.store=new Map};_.prototype.on=function(t,e){var o=this.store.get(t);o&&o.push(e)||this.store.set(t,[e])},_.prototype.off=function(t,e){var o=this.store.get(t),n=o.indexOf(e);o&&n>-1&&o.splice(n,1)},_.prototype.emit=function(t,e){this.store.get(t).slice().map((function(t){return t(e)}))};var g={hooks:{schemaOptions:[{handler:function(t,e){void 0===e&&(e={});var o=e.emit;return t.state=t.state||{},t.state.eventBus=new _,t.state.eventBus.on("events",(function(t){return o("events",t)})),t}}],schemaNode:[{handler:function(t,e){void 0===e&&(e={});var o=e.state,n=t.definition.attrs,r=n.events;void 0===r&&(r=[]);var s=n.on;void 0===s&&(s={});var a=function(t,e){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&-1===e.indexOf(n)&&(o[n]=t[n]);return o}(n,["events","on"]);return t.definition.attrs=a,t.definition.on=Object.assign({},s,r.reduce((function(e,n){return e[n]=function(e){s[n]&&s[n](e),o.eventBus.emit("events",{eventName:n,name:t.name,type:t.type,key:t.key,payload:e})},e}),{})),t}}]}},H={hooks:{model:[{handler:function(t,e){var n=e.context,r="vfe-mask"in n.attributes||"vfeMask"in n.attributes;if("text"===n.classification&&r){var s=n.attributes["vfe-mask"]||n.attributes.vfeMask,a="object"==typeof s&&s.mask?s:{mask:s};return o.createMask(a).resolve(t)}return t}}]}},F={hooks:{model:[{handler:function(t,e){var o=e.context,n="string"==typeof o.attributes.vfeNumber||o.attributes.vfeNumber||"string"==typeof o.attributes["vfe-number"]||o.attributes["vfe-number"];return"number"===o.type&&"string"==typeof t&&n?+t:t}}]}},O={FormulateForm:x,FormulateSchema:y,FormulateInput:f},P={formEvents:g,enforceNumber:F,textMask:H};export default function(t){void 0===t&&(t={});var e=n.merge({features:{formEvents:!0,textMask:!1,enforceNumber:!1},override:{FormulateForm:!0,FormulateInput:!0,FormulateSchema:!0}},t);return function(t){e.override.FormulateForm&&t.extend({components:{FormulateForm:x}}),e.override.FormulateInput&&t.extend({components:{FormulateInput:f}}),e.override.FormulateSchema&&t.extend({components:{FormulateSchema:y}}),e.features.formEvents&&t.extend(g),e.features.textMask&&t.extend(H),e.features.enforceNumber&&t.extend(F)}}export{O as components,P as features};
